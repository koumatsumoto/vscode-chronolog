# 機能仕様

## 拡張機能の有効化条件

- コマンド `Chronolog: Open Home`（chronolog.openHome）が呼び出されたときに拡張機能が有効化される（activationEvents: onCommand:chronolog.openHome）。

## ワークスペース初期化機能

- **トリガー:** VS Code でワークスペース (フォルダ) が開かれた際に自動実行。
- **処理フロー:**
  1. ワークスペースのルートディレクトリ直下に `.clog` という名称のフォルダが存在するか確認する。
  2. `.clog` フォルダが存在しない場合、新規に作成する。
  3. `.clog` フォルダ内に `memo` という名称のサブフォルダが存在するか確認する。
  4. `memo` サブフォルダが存在しない場合、`.clog/memo/` パスに新規に作成する。
- **将来的な拡張:** 設定ファイルの格納など、`.clog` フォルダの役割を拡張する予定。

## HomePanel（メモ入力・保存＋過去メモ一覧 UI）

- **UI形式:** VS Code のメインエディタ領域に表示される専用タブ（Webview を利用したカスタムUI）。
- **主要コンポーネント:**
  - **テキスト入力エリア (`textarea`):** 画面上部50%に表示。ユーザーが時系列メモの内容を入力する複数行テキストフィールド。
  - **保存ボタン (`button`):** テキスト入力エリア直下に配置。1文字以上入力時のみ活性化。
  - **過去のメモ一覧:** 画面下部50%に表示。.clog/memo フォルダ内のファイルを新しい順で最大10件、カード形式（shadow付き、幅100%、高さ固定、3行程度で省略表示）で一覧表示。各カードには1行目:日時、2行目:タイトル、3行目:本文（長文は...で省略）が表示される。スクロール可能。
- **データソース:** .clog/memo フォルダ配下の .clog ファイル群

## ファイル保存処理

- **トリガー:** ユーザーが UI 上の送信ボタンをクリックし、かつテキスト入力エリアに1文字以上の入力がある場合。
- **処理内容:**
  1. 処理実行時の現在日時を取得する。
  2. 取得した日時を基に、`YYYYMMDDTHHmmss` の形式（例: `20250506T115608`）の文字列を生成する。
  3. ファイル名を `<生成した日時文字列>.clog` とする (例: `20250506T115608.clog`)。
  4. 保存先ディレクトリを、ワークスペースルート直下の `.clog/memo/` とする。
  5. テキスト入力エリアに入力されているテキストデータをMarkdown bodyとして扱い、自動生成したYAMLフロントマターと組み合わせてclog形式のファイルを作成する。
  6. 生成したファイルを、指定された保存先ディレクトリにUTF-8エンコーディングで保存する。
- **ファイル形式:** `.clog` ファイルは、YAMLフロントマターとMarkdown bodyを組み合わせたハイブリッド形式。フロントマターには以下の情報が自動的に設定される：
  - `id`: UUID v4形式で自動生成される一意の識別子
  - `title`: Markdown bodyからh1見出しを抽出。h1がない場合は最初の行をタイトルとして使用
  - `created`: ファイル名と同じ日時文字列（YYYYMMDDThhmmss形式）

## メモ保存挙動

- メモ保存後もHomeパネルは閉じず、入力欄はクリアされる。
- 保存したメモは即座に履歴一覧に反映される。
- メモ入力欄でCtrl+Enterを押すと、保存ボタンを押した時と同じ動作（メモ保存）が行われる。
